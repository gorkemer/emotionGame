<!DOCTYPE html>
<html>
<head>
<title>Practice</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="jspsych-6.0.5/jspsych.js"></script>
<script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
<script src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
<script src="jspsych-6.0.5/plugins/jspsych-html-slider-response.js"></script>
<script src="jspsych-6.0.5/plugins/jspsych-survey-likert.js"></script>
<script src="jspsych-6.0.5/plugins/jspsych-survey-text.js"></script>

<link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>

</head>
<body> 
<!-- %style="background-color: color" -->
  
</body>

<script>
  //data saving
  function saveData() {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'write_data.php'); // change 'write_data.php' to point to php script.
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
      if(xhr.status == 200){
        var response = JSON.parse(xhr.responseText);
        console.log(response.success);
      }
    };
    xhr.send(jsPsych.data.get().json());
  }
  
  ///variables for drawing arrows
    var downArrow = "<p> <span style='font-size:200px;color: transparent;  text-shadow: 0 0 0 green; '>&#8681</span>"
    var lookNegative = "<span style='float: middle; font-size: 200px'>&#127909</span> " 
    var lookNeutral = "<span style='float: middle; font-size: 200px'>&#127909</span> " 
    var upArrow = "<span style='font-size:200px; color: transparent;  text-shadow: 0 0 0 red;'>&#8679</span></p>"


    /* create timeline */
    var timeline = [];
    
    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin." 
    };
    timeline.push(welcome);


    var randomGroup =1;

    var survey_trial = {
      type: 'survey-text',
      questions: [{prompt: "any prompt"}],
      on_finish: function(data){
      randomGroup = JSON.parse(data.responses).Q0; // update the global variable
      console.log('The trial just finished loading.', randomGroup)}
    };
    
    timeline.push(survey_trial);

    console.log('randomGroup is ', randomGroup)

    //creating images lowest valance to highest

    // get the image file names

    // get the group randomization, roll the dice

    // distribute image lists in accordance with the randomized number (done)

    // tag data saving parameter

    // debug


    var subCond = jsPsych.data.getURLVariable('sub_cond');

    if (typeof subCond === "undefined") {
    alert("subject condition is undefined, assigning arbitrarily");
    var subCond = 1;
    }


    //orumcek
    var imageList1 = [ 
      "testImageSet/3102.jpg", 
      "testImageSet/3064.jpg",
      "testImageSet/3130.jpg",
      "testImageSet/3001.jpg",
      "testImageSet/3266.jpg",
      "testImageSet/3100.jpg",
      "testImageSet/3005.1.jpg",
      "testImageSet/9570.jpg",
      "testImageSet/3010.jpg",
      "testImageSet/2800.jpg",

      "testImageSet/3060.jpg",
      "testImageSet/3225.jpg",
      "testImageSet/9187.jpg",
      "testImageSet/3140.jpg",
      "testImageSet/9433.jpg",
      "testImageSet/3350.jpg",
      "testImageSet/6350.jpg",
      "testImageSet/3030.jpg",
      "testImageSet/6520.jpg",
      "testImageSet/9571.jpg",
    ];

    //yilanlar
    var imageList2 = [
      "testImageSet/3053.jpg", 
      "testImageSet/3170.jpg",
      "testImageSet/3131.jpg",
      "testImageSet/3120.jpg",
      "testImageSet/3000.jpg",
      "testImageSet/9940.jpg",
      "testImageSet/9075.jpg",
      "testImageSet/9183.jpg",
      "testImageSet/9413.jpg",
      "testImageSet/3261.jpg",

      "testImageSet/3010.jpg",
      "testImageSet/3530.jpg",
      "testImageSet/3301.jpg",
      "testImageSet/9405.jpg",
      "testImageSet/3062.jpg",
      "testImageSet/9325.jpg",
      "testImageSet/9635.1.jpg",
      "testImageSet/3101.jpg",
      "testImageSet/9921.jpg",
      "testImageSet/9185.jpg",
    ];

    //ari falan
    var imageList3 = [
      "testImageSet/3063.jpg", 
      "testImageSet/3080.jpg",
      "testImageSet/9410.jpg",
      "testImageSet/3168.jpg",
      "testImageSet/3000.jpg",
      "testImageSet/3015.jpg",
      "testImageSet/9040.jpg",
      "testImageSet/3069.jpg",
      "testImageSet/6563.jpg",

      "testImageSet/3110.jpg",
      "testImageSet/3068.jpg",
      "testImageSet/3059.jpg",
      "testImageSet/2095.jpg",
      "testImageSet/9412.jpg",
      "testImageSet/3071.jpg",
      "testImageSet/3016.jpg",
      "testImageSet/2703.jpg",
      "testImageSet/3180.jpg",
      "testImageSet/3191.jpg",
      "testImageSet/6313.jpg",
    ];

        //arbitrary falan
    var imageList4 = [
      "testImageSet/8065.jpg", 
      "testImageSet/5940.jpg",
      "testImageSet/8160.jpg",
      "testImageSet/7560.jpg",
      "testImageSet/3250.jpg",
      "testImageSet/3550.2.jpg",
      "testImageSet/2220.jpg",
      "testImageSet/1321.jpg",
      "testImageSet/5920.jpg",

      "testImageSet/6900.jpg",
      "testImageSet/1302.jpg",
      "testImageSet/9422.jpg",
      "testImageSet/2780.jpg",
      "testImageSet/9150.jpg",
      "testImageSet/9411.jpg",
      "testImageSet/7640.jpg",
      "testImageSet/1645.jpg",
      "testImageSet/8475.jpg",
      "testImageSet/1726.jpg",
      "testImageSet/2661.jpg",

    ];

    var testStimuli = [];

    //distribution of cues
    for (var i=0; i<imageList1.length; i++) {

      if (subCond == 1){ //first condition: lookNegative
        
        var first = true;
        var second = false;
        var third = false;

        var trial_obj1 = {stimulus: imageList1[i], cue: lookNegative};
        //tag data variable here
        var trial_obj2 = {stimulus: imageList2[i], cue: upArrow};
        //tag data vaiable here
        var trial_obj3 = {stimulus: imageList3[i], cue: downArrow};
        //tag data variable here
        var trial_obj4 = {stimulus: imageList4[i], cue: lookNeutral};
        //tag data variable here

      
      } 

      else if (subCond == 2){ //second condition: upArrow
        var trial_obj1 = {stimulus: imageList1[i], cue: upArrow};
        //tag data variable here
        var trial_obj2 = {stimulus: imageList2[i], cue: downArrow};
        //tag data variable here
        var trial_obj3 = {stimulus: imageList3[i], cue: lookNeutral};
        //tag data variable here
        var trial_obj4 = {stimulus: imageList4[i], cue: lookNegative};
        //tag data variable here
      } 

      else if (subCond == 3){ //third condition: downArrow
        var trial_obj1 = {stimulus: imageList1[i], cue: downArrow};
        //tag data variable here
        var trial_obj2 = {stimulus: imageList2[i], cue: lookNeutral};
        //tag data variable here
        var trial_obj3 = {stimulus: imageList3[i], cue: lookNegative};
        //tag data variable here
        var trial_obj3 = {stimulus: imageList4[i], cue: upArrow};
        //tag data variable here
      } 

      else if (subCond == 4){ //third condition: lookNeutral
        var trial_obj1 = {stimulus: imageList1[i], cue: lookNeutral};
        //tag data variable here
        var trial_obj2 = {stimulus: imageList2[i], cue: lookNegative};
        //tag data variable here
        var trial_obj3 = {stimulus: imageList3[i], cue: upArrow};
        //tag data variable here
        var trial_obj3 = {stimulus: imageList4[i], cue: downArrow};
        //tag data variable here
      } 

      testStimuli.push(trial_obj1);
      testStimuli.push(trial_obj2);
      testStimuli.push(trial_obj3);
      testStimuli.push(trial_obj4);
      // randomizing the test stimuli
      //jsPsych.randomization.shuffle(testStimuli);
    }



    // console.log('test stimuli array: ', testStimuli); // print the array to the console to see if this worked as expected
    
    //Trial initialization  
    var fixation = {
      type: 'html-keyboard-response',
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: 1000,
      data: {test_part: 'fixation'}
    };
    
    var cueTrial = {
        type: "html-keyboard-response",
        stimulus: jsPsych.timelineVariable('cue'),
        trial_duration: 2500
    };


    var testTrial = {
      type: "image-keyboard-response",
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.NO_KEYS,
      trial_duration: 1000,
      data: jsPsych.timelineVariable('data')
      //timeline: trials
    }
    
    // defining two different response scales that can be used.
    var scale_1 = ["1", "2", "3", "4", "5", "6", "7"];
  
    var responseTrial = {
        type: 'survey-likert',
        questions: [{prompt: "How negative do you feel?", labels: scale_1}],
        trial_duration: 2500
    };

    var test_procedure = {
        timeline: [cueTrial, testTrial, responseTrial, fixation],
        timeline_variables: testStimuli,
        randomize_order: true
    }
    // jsPsych.data.addProperties({
    // subject: subjectID
    // });
    
    timeline.push(test_procedure);
    
    jsPsych.init({
      timeline: timeline,
      on_finish: saveData
    });

</script>
</html>
